<UserControl
    x:Class="Scrubbler.Plugin.Scrobblers.DatabaseScrobbler.AlbumResultsView"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:local="using:Scrubbler.Plugin.Scrobblers.DatabaseScrobbler"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:conv="using:Scrubbler.Abstractions.Converter"
    xmlns:beh="using:Microsoft.Xaml.Interactivity"
    xmlns:actions="using:Microsoft.Xaml.Interactions.Core"
    mc:Ignorable="d"
    d:DesignHeight="300"
    d:DesignWidth="400">

    <UserControl.Resources>
        <conv:BoolToVisibilityConverter x:Key="BoolToVisibilityConv"/>
    </UserControl.Resources>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="5"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <Button Grid.Row="0" HorizontalAlignment="Left" Content="Back to artists" Command="{Binding GoBackCommand}" Visibility="{Binding CanGoBack, Converter={StaticResource BoolToVisibilityConv}}"/>

        <ScrollViewer Grid.Row="2" x:Name="ScrollViewer">
            <beh:Interaction.Behaviors>
                <beh:DataTriggerBehavior Binding="{Binding TypedResults.Count}" Value="0">
                    <actions:ChangePropertyAction TargetObject="{Binding ElementName=ScrollViewer}"
                                      PropertyName="Visibility" Value="Collapsed"/>
                </beh:DataTriggerBehavior>
            </beh:Interaction.Behaviors>

            <ItemsRepeater ItemsSource="{Binding TypedResults}">
                <ItemsRepeater.Layout>
                    <FlowLayout Orientation="Horizontal" MinRowSpacing="8" MinColumnSpacing="8"/>
                </ItemsRepeater.Layout>

                <ItemsRepeater.ItemTemplate>
                    <DataTemplate>
                        <Grid>
                            <beh:Interaction.Behaviors>
                                <beh:EventTriggerBehavior EventName="Tapped">
                                    <actions:InvokeCommandAction Command="{Binding ClickedCommand}" />
                                </beh:EventTriggerBehavior>
                            </beh:Interaction.Behaviors>

                            <Border Padding="8" BorderBrush="DarkGray" BorderThickness="1" CornerRadius="10">
                                <StackPanel Orientation="Vertical" Width="128" Height="180" Spacing="10">
                                    <Image Width="128" Height="128">
                                        <Image.Source>
                                            <BitmapImage UriSource="{Binding Image, TargetNullValue=ms-appx:///Assets/noartistimage.png}" />
                                        </Image.Source>
                                    </Image>
                                    <TextBlock MaxWidth="128"
                                           Text="{Binding ArtistName}"
                                           TextAlignment="Center"
                                           TextTrimming="CharacterEllipsis"
                                           TextWrapping="NoWrap"/>
                                    <TextBlock MaxWidth="128"
                                           Text="{Binding Name}"
                                           TextAlignment="Center"
                                           TextTrimming="CharacterEllipsis"
                                           TextWrapping="NoWrap"/>
                                </StackPanel>
                            </Border>
                        </Grid>
                    </DataTemplate>
                </ItemsRepeater.ItemTemplate>
            </ItemsRepeater>
        </ScrollViewer>

        <TextBlock x:Name="NoResultsText" Grid.Row="2" HorizontalAlignment="Center" VerticalAlignment="Center" FontSize="24" Text="No albums found">
            <beh:Interaction.Behaviors>
                <beh:DataTriggerBehavior Binding="{Binding TypedResults.Count}" Value="0" ComparisonCondition="GreaterThan">
                    <actions:ChangePropertyAction TargetObject="{Binding ElementName=NoResultsText}"
                                      PropertyName="Visibility" Value="Collapsed"/>
                </beh:DataTriggerBehavior>
            </beh:Interaction.Behaviors>
        </TextBlock>
    </Grid>
</UserControl>
